experiment_id: exp0034
experiment_name: "High専門家Optuna最適化版MoE"
base_experiment: exp0033
creation_date: "2025-10-05"
status: ready_to_run

objective:
  primary: "High専門家のハイパーパラメータをOptuna最適化し、MoE全体の精度を向上させる"
  secondary:
    - "High領域専用のパラメータで過学習を抑制"
    - "ゼロ閾値最適化（exp0033）との相乗効果を実現"

baseline_scores:
  exp0031_high_expert_wrmse: 0.392
  exp0031_moe_oof: 0.2271
  exp0033_moe_oof: "TBD (exp0033実行後に更新)"

target_scores:
  high_expert_wrmse: 0.25
  moe_oof_wrmse: 0.22
  expected_improvement: -0.007

methodology:
  approach: "High専門家専用のOptuna最適化によるハイパーパラメータチューニング"
  techniques:
    - "Fold1のHigh領域データで最適化"
    - "50 trials でTPESampler使用"
    - "wRMSEを目的関数として最小化"
    - "正則化パラメータを含む7次元探索"

  optimization_parameters:
    num_leaves:
      range: [10, 60]
      description: "木の複雑さ"
    learning_rate:
      range: [0.01, 0.1]
      scale: "log"
      description: "学習率"
    min_child_samples:
      range: [20, 100]
      description: "ノードの最小サンプル数（過学習抑制）"
    reg_alpha:
      range: [0.0, 1.0]
      description: "L1正則化"
    reg_lambda:
      range: [0.0, 2.0]
      description: "L2正則化"
    feature_fraction:
      range: [0.7, 1.0]
      description: "特徴量サンプリング率"
    bagging_fraction:
      range: [0.7, 1.0]
      description: "データサンプリング率"

  implementation_steps:
    - step: "Step 4.5 (新規)"
      description: "High専門家のOptuna最適化"
      details:
        - "Fold1のHigh領域でハイパーパラメータ探索"
        - "50 trials でTPESampler使用"
        - "最適パラメータを high_expert_params に反映"

    - step: "Step 4 (更新)"
      description: "High専門家の学習"
      details:
        - "Optuna最適化済みパラメータを使用"
        - "全Foldで学習"

    - step: "Step 5.5"
      description: "ゼロ閾値最適化（exp0033から継承）"
      details:
        - "MoE予測にゼロ閾値を適用"

    - step: "Step 6"
      description: "メトリクス保存"
      details:
        - "High専門家の最適パラメータを記録"
        - "MoE OOF wRMSEを記録"

expected_outcomes:
  - "High専門家のwRMSEが0.392 → 0.25に改善"
  - "MoE全体のOOF wRMSEが0.2271 → 0.22に改善"
  - "ゼロ閾値最適化との相乗効果でさらなる改善"
  - "過学習が抑制され、CV/OOFの乖離が削減"

validation_points:
  - "Optuna最適化が収束しているか（50 trialsで十分か）"
  - "最適パラメータが妥当な範囲か"
  - "High専門家のOOF wRMSEがexp0031比で改善しているか"
  - "MoE OOF wRMSEがexp0031/exp0033比で改善しているか"
  - "ゲート分離精度（AUC/AP）が維持されているか"

artifacts:
  notebook: "training_with_high_optuna.ipynb"
  metrics: "logs/host_moe_high_optuna_001_metrics.json"
  oof_predictions: "artifacts/oof_predictions_moe_high_optuna.csv"
  submission: "submissions/host_moe_high_optuna_001_submission.csv"

execution_time:
  high_optuna_optimization: "15-20分（50 trials、GPU使用時）"
  total_execution: "30-40分"

next_steps:
  - id: exp0035
    description: "Low専門家のOptuna最適化"
    rationale: "High専門家の改善が確認できたら、Low専門家も最適化"

  - id: future
    description: "3専門家MoE（Low/Mid/High）"
    rationale: "両専門家の性能向上後、階層的分離を試行"

  - id: future
    description: "温度パラメータτの再最適化"
    rationale: "専門家性能向上後のτ探索"

tags:
  - MoE
  - High-Expert
  - Optuna
  - Hyperparameter-Optimization
  - Regularization
  - Zero-Threshold

references:
  - "exp0031: 木モデル版MoE（ベースライン）"
  - "exp0033: ゼロ閾値最適化版MoE"
  - "exp0032: 対数変換版（悪化事例）"
  - "exp0027: StratifiedGKFoldでCV安定化（Optuna最適化実績）"

notes:
  - "High領域はサンプル数が少ない（約30%）ため、過学習しやすい"
  - "正則化パラメータ（min_child_samples、reg_alpha、reg_lambda）が重要"
  - "exp0032で対数変換が悪化したため、パラメータ最適化に注力"
